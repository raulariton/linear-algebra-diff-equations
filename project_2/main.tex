\documentclass[a4paper,12pt]{article}
\usepackage[english]{babel}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{listings}
\usepackage{xcolor}
\usepackage{pgf}
\usepackage{float}
\usepackage{lmodern}
\usepackage{siunitx}
\DeclareSIUnit\mile{mi}

% default font selection
\renewcommand{\familydefault}{\sfdefault}
% \usepackage[default]{sourcesanspro}
% \usepackage{libertinus}

\lstset{
  language=Python,
  basicstyle=\ttfamily\small,
  keywordstyle=\color{blue},
  stringstyle=\color{orange},
  commentstyle=\color{gray},
  numbers=left,
  numberstyle=\tiny\color{gray},
  frame=single,
  breaklines=true,
}

\usepackage{graphicx}

% math symbols and fonts
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{mathrsfs}

% d for derivatives
\usepackage{fixdif}

% SI units
\usepackage{siunitx}

% framed environment, might use in problem introduction
\usepackage{framed}

% bibtex setup
\usepackage[backend=biber,
            style=ieee,
            ]{biblatex}
\addbibresource{bibliography.bib}

\usepackage{cancel}

% context-sensitive quotes package (biblatex suggests using it, idk what it does exactly)
\usepackage{csquotes}

% hyperref package; convention to always add as last package
\usepackage{hyperref}

% adding text spacing in math mode
\renewcommand*{\textnormal}[1]{\text{ #1 }}

% removing highlighting of hyperref links
\hypersetup{pdfborder={0 0 0}}

% remove indentation
\setlength{\parindent}{0pt}

\newcommand\numberthis{\addtocounter{equation}{1}\tag{\theequation}}

\begin{document}

\begin{titlepage}
    \vspace*{-3cm}
    \centering
    \includegraphics[width=2cm]{assets/uvt_logo_en.png}

    {\scshape\LARGE West University of Timișoara\par}

    \vspace{1cm}

    {\large Faculty of Computer Science}

    \vspace{.1\textheight}
    { \LARGE \scshape Project 2: \\ Cleaning Up the Great Lakes \par}

    \vspace{.1\linewidth}

    {\emph{Authors:} \\
        Raul-Andrei \textsc{Ariton} (\textit{Group 2}) \\
        Maria-Miruna \textsc{Mesaroșiu} (\textit{Group 1}) \\
        Silviu-Ștefan \textsc{Mitrea} (\textit{Group 1}) \\
    }

    \vfill

    \rule{.4\textwidth}{.4pt}

    {\large \today\par
        Academic Year 2025-2026\par}
\end{titlepage}

\tableofcontents \newpage

\section{Cleaning Up the Great Lakes}

In this project, we aim to solve a \textit{compartmental modelling} problem proposed in \cite[pp.~313--314]{Kent_Nagle2018-ig}. The problem involves estimating the time it would take to clean up the Great Lakes (figure~\ref{fig:great_lakes}) of pollutants at varying levels of accuracy.

\begin{figure}[h!]
    \centering
    \includegraphics[width=0.7\textwidth]{assets/great_lakes.png}
    \caption{The Great Lakes of North America}
    \label{fig:great_lakes}
\end{figure}

\citeauthor*{Kent_Nagle2018-ig} models each lake as a tank, containing a liquid (water) dissolved with a pollutant (DDT, phosphorus, mercury).

The following assumptions are made and maintained for the entirety of the problem:
\begin{itemize}
    \item The volume of each lake remains constant.
    \item The flow rates are constant throughout the year.
    \item When a liquid enters the lake, perfect mixing occurs and the pollutants are uniformly distributed throughout the lakes.
    \item Pollutants are dissolved in the water and enter or leave by inflow or outflow of water.
\end{itemize}

\newpage \section{``Draining'' each lake of pollutants} \label{sec:draining_lakes}

\begin{framed}
    \noindent Use the outflow rates given to determine the time it would take to ``drain'' each lake. This gives a lower bound on how long it would take to remove all the pollutants.
\end{framed}

\begin{figure}[h!]
    \centering
    \includegraphics[width=\textwidth]{assets/great_lakes_compartmental_model.png}
    \caption{Compartmental model of the Great Lakes with flow rates ($\unit{\cubic\mile \per \text{year}}$) and volumes ($\unit{\cubic\mile}$) \cite{Kent_Nagle2018-ig}}
    \label{fig:great_lakes_model}
\end{figure}

It is important to note that, in this context, ``draining'' a lake does not refer to removing all the water from it, but rather to removing all the pollutants dissolved in the water.

Since we are given the outflow rates for each lake (in $\unit{\cubic\mile \per \text{year}}$) and the volumes of each lake (in $\unit{\cubic\mile}$) (see figure~\ref{fig:great_lakes_model}), the time (in years) that it would take to drain (remove all pollutants from) each lake can be simply computed as:
\begin{gather*}
    \text{Time to drain lake} = \frac{\text{Volume of lake}}{\text{Outflow rate}} \\
    t = \frac{V}{r}
\end{gather*}

Table~\ref{table:drain_times} shows the computed times to drain each lake, using the given volumes and outflow rates.

\begin{table}[h!]
    \centering
    \begin{tabular}{|c|c|}

        \hline

        Lake     & Time (in years) to ``drain'' \\

        \hline

        Superior & 193.33                       \\
        \hline
        Michigan & 31.05                        \\
        \hline
        Huron    & 12.50                        \\
        \hline
        Erie     & 1.36                         \\
        \hline
        Ontario  & 3.97                         \\
        \hline
    \end{tabular}
    \caption{Time to ``drain'' each of the Great Lakes}
    \label{table:drain_times}
\end{table}

\subsection{An additional explanation}

We have assumed that volume of all the lakes remain constant, meaning that the inflow rate \(r_{i}\) is equal to the outflow rate \(r\). To model this problem in an even simpler manner, we can think of each lake as a full cup of water with soda syrup dissolved in it. If we were to place the cup over a sink, and start pouring water into the cup while letting the water-syrup mixture flow out of the cup, we would eventually end up with a cup full of only water, as the syrup would be washed away by the inflowing water. The time it would take to completely wash away the syrup from the cup can be computed by dividing the volume of the cup by the outflow rate. Notice how the volume of the cup remains constant (full).

\newpage \section{Assuming clean water inflow}
\label{sect:point_b}

\begin{framed}
    \noindent A better estimate is obtained by assuming that each lake is a separate tank with \emph{only} clean water flowing in. Use this approach to determine how long it would take the pollution level in each lake to be reduced to 50\% of its original level. How long would it take to reduce the pollution to 5\% of its original level?
\end{framed}

Let us consider the following notation:
\begin{itemize}
    \item \(V\) - volume of the lake ($\unit{\cubic\mile}$)
    \item \(r\) - outflow rate ($\unit{\cubic\mile \per \text{year}}$)
    \item \(C(t)\) - concentration of pollutant in the lake at time \(t\) ($\unit{\kilo\gram / \cubic\mile}$) (mass per unit volume = $\frac{y(t)}{V}$)
    \item \(C_0\) - initial concentration of pollutant in the lake at time \(t = 0\) ($\unit{\kilo\gram / \cubic\mile}$)
    \item \(y(t)\) - mass of pollutant in the lake at time \(t\) ($\unit{\kilo\gram}$)
\end{itemize}

The rate of change of the mass of pollutant in a lake is equal to the inflow of the pollutant minus the outflow of the pollutant:
\begin{gather*}
    \frac{\d y}{\d t} = \text{inflow of pollutant} - \text{outflow of pollutant}
\end{gather*}
Since inflow water is clean, the inflow of pollutant is equal to zero:
\begin{gather*}
    \frac{\d y}{\d t} = 0 - \text{outflow of pollutant}
\end{gather*}
The outflow of pollutant is equal to the outflow rate of the lake times the concentration of pollutant in the lake (this number represents the amount of pollutant leaving the lake as water flows out):
\begin{gather*}
    \frac{\d y}{\d t} = - r \cdot C(t)
\end{gather*}
Since concentration is defined as mass per unit volume, we can rewrite the formula as:
\begin{gather*}
    \frac{\d y}{\d t} = - \frac{r}{V} \cdot  y(t)
\end{gather*}

This is a separable equation, so we can solve it by first separating the variables on opposite sides of the equation:
\begin{gather*}
    \frac{1}{y}  dy = -\frac{r}{V} dt
\end{gather*}
Next, we integrate both sides of the equation to reach the implicit solution:
\begin{gather*}
    \int \frac{1}{y}  dy = \int -\frac{r}{V} dt \\
    ln(y) = -\frac{r}{V} \cdot t + C \\
    e^{ln(y)} = e^{-\frac{r}{V} \cdot t} \cdot e^{C} \\
    y = e^{-\frac{r}{V} \cdot t} \cdot C
\end{gather*}

To determine \(C\), we use the initial condition that at time \(t = 0\), the mass of pollutant is equal to the initial one \(y_0\):
\begin{gather*}
    y(0) = e^{-\frac{r}{V} \cdot 0} \cdot C \implies C = y_0
\end{gather*}
Therefore, the rate of change of the mass of pollutant in the lake over time is dependent on the initial mass:
\begin{gather*}
    y(t) = y_0 e^{-\frac{r}{V} \cdot t}
\end{gather*}
From section~\ref{sec:draining_lakes} we know the values of $\frac{V}{r}$, which in here we can denote as \(\tau\). In this manner, the final form  of our equation becomes:
\begin{equation}
    y(t) = y_0 e^{-\frac{t}{\tau}}
    \label{eq:concentration_over_time}
\end{equation}

\subsection{Time to reduce pollution to 50\%} \label{sec:reduce_50_percent}

To find the time \(t\) it takes to reduce the pollution to 50\% of its original level, we must find the \(t\) such that:
\begin{gather*}
    y(t) = 0.5 \cdot y_0
\end{gather*}
Using equation~\eqref{eq:concentration_over_time}, we have:
\begin{gather*}
    y_0 e^{-\frac{t}{\tau}} = 0.5 \cdot y_0 \\
    e^{-\frac{t}{\tau}} = 0.5 \\
    -\frac{t}{\tau}  = \ln(0.5) \\
    t = - \tau \ln(0.5) \\
    t = - \tau \cdot 0.6931
\end{gather*}

An important observation is that, since the initial level of pollutant \(y_0\) cancels out, the time to reduce pollution is independent of its initial mass.

Table~\ref{table:reduce_50_percent_times} shows the computed times to reduce the pollution level to 50\% of its original one for each lake, using the given volumes and outflow rates.

\begin{table}[H]
    \centering
    \begin{tabular}{|c|c|}

        \hline

        Lake     & Time (in years) to reduce pollution to 50\% \\

        \hline

        Superior & 134.01                                      \\
        \hline
        Michigan & 21.52                                       \\
        \hline
        Huron    & 8.66                                        \\
        \hline
        Erie     & 0.95                                        \\
        \hline
        Ontario  & 2.75                                        \\
        \hline
    \end{tabular}
    \caption{Time to reduce pollution to 50\% in each of the Great Lakes}
    \label{table:reduce_50_percent_times}
\end{table}

\subsection{Time to reduce pollution to 5\%}

Similarly, as in section~\ref{sec:reduce_50_percent}, the time \(t\) it takes for each lake to reduce the pollution level to 5\% of its original level can be computed with:
\begin{gather*}
    t = -{\tau} \cdot \ln(0.05) \\
    t = -\tau \cdot 2.9957
\end{gather*}

Table~\ref{table:reduce_5_percent_times} shows the computed times to reduce the pollution level to 5\% of its original level for each lake, using the given volumes and outflow rates.

\begin{table}[H]
    \centering
    \begin{tabular}{|c|c|}

        \hline

        Lake     & Time (in years) to reduce pollution to 5\% \\

        \hline

        Superior & 579.17                                     \\
        \hline
        Michigan & 93.03                                      \\
        \hline
        Huron    & 37.45                                      \\
        \hline
        Erie     & 4.09                                       \\
        \hline
        Ontario  & 11.89                                      \\
        \hline
    \end{tabular}
    \caption{Time to reduce pollution to 5\% in each of the Great Lakes}
    \label{table:reduce_5_percent_times}
\end{table}

Figure~\ref{fig:pollution_decay} illustrates the reduction (\emph{decay}) of pollution in each of the Great Lakes over time, assuming clean water inflow. The plot was generated using the \texttt{matplotlib} library in Python. The code can be found in listing~\ref{lst:pollution-reduction-plot}.
\begin{figure}[H]
    \centering
    \scalebox{0.85}{\input{assets/pollution_decay.pgf}}
    \caption{Reduction of pollution in the Great Lakes over time, assuming clean water inflow}
    \label{fig:pollution_decay}
\end{figure}

\paragraph{One more step of modelling.} Of course, lakes do not exist in isolation, and the outflow of one lake often serves as the inflow for another, meaning that pollutants can be transferred between lakes. The next section takes modelling a step further by taking this into consideration, for the highest level of accuracy in estimating pollution reduction times.

\newpage \section{Taking into account flow between lakes}

\begin{framed}
    \noindent Finally, to take into account the fact that pollution from one lake flows into the next lake in the chain, use the entire multiple compartment model given to determine when the pollution level in each lake has been reduced to 50\% of its original level, assuming pollution has ceased (that is, inflows not from a lake are clean water). Assume that all the lakes initially have the same pollution concentration p. How long would it take for the pollution to be reduced to 5\% of its original level?
\end{framed}

To determine the time it would take to reduce the pollution level by a certain percentage in each lake, we must determine the formulas for the mass of pollutant in each lake over time, now taking into account flow between lakes.

Using the assumption that all lakes initially have the same pollution concentration p, we can write:

$$
    p = \frac{y_{S}}{V_{S}} = \frac{y_{M}}{V_{M}} = \frac{y_{H}}{V_{H}} = \frac{y_{E}}{V_{E}} = \frac{y_{N}}{V_{N}}
$$

From this we can denote that for any lake, at $t = 0$ their level of pollutant is:
$$y_{0} = p  V$$


We begin in the same way as before, with the rate of change of the pollutant mass in the water
\begin{gather*}
    \frac{\d y}{\d t} = \text{inflow of pollutant} - \text{outflow of pollutant}
\end{gather*}

\subsection*{Finding the mass of pollutant in lakes Superior and Michigan over time}
As seen in figure~\ref{fig:great_lakes_model}, lakes \textbf{Superior} and \textbf{Michigan} have no inflow from other lakes, so their inflow of pollutant is equal to zero, therefore the level of pollutant in these lakes is given by equation~\eqref{eq:concentration_over_time}, where $k = \frac{1}{\tau} = \frac{r}{V}$.
\begin{equation*}
    y_{S}(t) = y_{S_0} \cdot e^{-k_{S}t} = (p \cdot V_{S}) \cdot e^{-k_{S}t}\\
\end{equation*}
\begin{equation*}
    y_{M}(t) = y_{M_0} \cdot e^{-k_{M}t} = (p \cdot V_{M}) \cdot e^{-k_{M}t}
\end{equation*}
Let us denote \(p V_S = A\) and \(p V_M = B\) for simplicity.
\begin{equation}
    \label{eq:mass_pollutant_superior}
    y_{S}(t) = A \cdot e^{-k_{S}t}
\end{equation}
\begin{equation}
    \label{eq:mass_pollutant_michigan}
    y_{M}(t) = B \cdot e^{-k_{M}t}
\end{equation}

\subsection*{Finding the mass of pollutant in lake Huron over time}
For lake \textbf{Huron}, the inflow of pollutant comes from lake Superior and Michigan. Thus, the rate of change of pollutant mass in lake Huron is:
\begin{gather*}
    \frac{\d y_{H}}{\d t} = r_{S} \cdot \frac{y_{S}}{V_S} + r_{M} \cdot \frac{y_{M}}{V_M} - r_{H} \cdot \frac{y_{H}}{V_H}
\end{gather*}


By substituting we get the form:

$$\frac{\d y_H}{\d t} = \left(k_S \cdot y_S + k_M \cdot y_M\right) - k_H \cdot y_H$$


This is a first-order linear differential equation. Let us write it in standard form $\frac{\d y}{\d x} + P(x) \cdot y = F(x)$:

$$\frac{\d y_H}{\d t} + k_H \cdot y_H = k_S \cdot y_S + k_M \cdot y_M $$

We use the integrating factor method to solve this differential equation. The integrating factor \(\mu(t)\) is given by:
\begin{gather*}
    \mu(t) = e^{\int p(t) \, \d t} \\
    \mu(t) = e^{\int k_H \, \d t} = e^{k_H t}
\end{gather*}

We multiply both sides of the differential equation by the integrating factor:
\begin{gather*}
    e^{k_H t} \cdot  (\frac{\d y_H}{\d t} + k_H \cdot y_H) = e^{k_H t} \cdot (k_S \cdot y_S + k_M \cdot y_M) \\
    e^{k_H t} \cdot \frac{\d}{\d t}( y_H) + \frac{\d}{\d t} e^{k_H t}  \cdot y_H = e^{k_H t} \cdot (k_S \cdot y_S + k_M \cdot y_M) \\
    \frac{\d}{\d t}(e^{k_H t} \cdot y_H) = e^{k_H t} \cdot (k_S \cdot y_S + k_M \cdot y_M)
\end{gather*}

Integrating both sides with respect to \(t\), we obtain:
\begin{gather*}
    e^{k_H t} y_H = \int e^{k_H t} (k_S y_S + k_M y_M) \, \d t \\
    e^{k_H t} y_H = \int e^{k_H t} (k_S y_{S_0} e^{-k_S t} + k_M y_{M_0} e^{-k_M t}) \, \d t \\
    e^{k_H t} y_H = \int k_S y_{S_0} e^{-k_S t + k_H t} \, \d t + \int k_M y_{M_0} e^{-k_M t + k_H t} \, \d t \\
    e^{k_H t} y_H = k_S y_{S_0} \int e^{-k_S t + k_H t} \, \d t + k_M y_{M_0} \int e^{-k_M t + k_H t} \, \d t \\
    e^{k_H t} y_H = k_S y_{S_0} \left[\frac{1}{- k_S + k_H} e^{- k_S t + k_H t}\right] + k_M y_{M_0} \left[\frac{1}{- k_M + k_H} e^{- k_M t + k_H t}\right] + C_H \\
    e^{k_H t} y_H = \frac{k_S y_{S_0}}{k_H - k_S} e^{- k_S t + k_H t} + \frac{k_M y_{M_0}}{k_H - k_M} e^{- k_M t + k_H t} + C_H
\end{gather*}
Where \(C_H\) is a constant \(\in \mathbb{R}\).
Now we solve for \(y_H\) to obtain the formula for the mass of pollutant in lake Huron over time:
\begin{gather*}
    y_H(t) = \frac{k_S y_{S_0}}{k_H - k_S} e^{- k_S t + k_H t - k_H t} + \frac{k_M y_{M_0}}{k_H - k_M} e^{- k_M t + k_H t - k_H t} + C_H e^{-k_H t} \\
    y_H(t) = \frac{k_S y_{S_0}}{k_H - k_S} e^{- k_S t} + \frac{k_M y_{M_0}}{k_H - k_M} e^{- k_M t} + C_H e^{-k_H t}
\end{gather*}
Recalling that \(y_{S_0} = A\) and \(y_{M_0} = B\), we can notice that:
\begin{gather*}
    y_H(t) = \frac{k_S}{k_H - k_S} A e^{- k_S t} + \frac{k_M}{k_H - k_M} B e^{- k_M t} + C_H e^{-k_H t}
\end{gather*}
Let us denote:
\[
    y_H(t) = \underbrace{\frac{k_S}{k_H - k_S} A}_{H_S} e^{- k_S t} + \underbrace{\frac{k_M}{k_H - k_M} B}_{H_M} e^{- k_M t} + C_H e^{-k_H t} \\
\]
We notice that:
\begin{gather*}
    H_i = \frac{k_i}{k_H - k_i} V_i p
\end{gather*}
So the final equation for the mass of pollutant in lake Huron over time is:
\begin{equation}
    \label{eq:mass_pollutant_huron_with_constant}
    y_H(t) = H_S e^{- k_S t} + H_M e^{- k_M t} + C_H e^{-k_H t}
\end{equation}

\subsection*{Finding the mass of pollutant in lakes Erie and Ontario over time}
For lake \textbf{Erie}, the inflow comes from lake Huron. So, applying the same logic as previously done, the rate of change of pollutant mass in lake Erie is:
\begin{gather*}
    \frac{\d y_{E}}{\d t} = k_H \cdot y_H - k_E \cdot y_E
\end{gather*}

This is a first-order linear differential equation:

$$
    \frac{\d y_{E}}{\d t} = k_H \cdot y_H - k_E \cdot y_E
$$
$$
    \frac{\d y_{E}}{\d t} + k_E \cdot y_E = k_H \cdot y_H
$$

We find the integrating factor:
$$
    \mu(t) = \int e ^ {k_E t} \d t = e^{k_E t}
$$

Then we multiply both sides by the integrating factor:

\begin{gather*}
    e^{k_E t} \cdot  (\frac{\d y_E}{\d t} + k_E \cdot y_E) = e^{k_E t} \cdot k_H \cdot y_H  \\
    e^{k_E t} \cdot \frac{\d}{\d t}( y_E) + \frac{\d}{\d t} e^{k_E t}  \cdot y_E = e^{k_H t} \cdot k_H \cdot y_H \\
    \frac{\d}{\d t}(e^{k_E t} \cdot y_E) = e^{k_E t} \cdot k_H \cdot y_H
\end{gather*}
Integrating both sides with respect to \(t\), we obtain:
\begin{gather*}
    \frac{\d}{\d t}(e^{k_E t} \cdot y_E) = e^{k_E t} \cdot k_H \cdot y_H \\
    e^{k_E t} y_E = \int e^{k_E t} k_H \left(H_S e^{- k_S t} + H_M e^{- k_M t} + C_H e^{-k_H t}\right)  \d t \\
    e^{k_E t} y_E = \int k_H H_S e^{- k_S t + k_E t} \, \d t + \int k_H H_M e^{- k_M t + k_E t} \, \d t + \int k_H C_H e^{-k_H t + k_E t} \, \d t \\
\end{gather*}
\begin{equation*}
    \begin{split}
        e^{k_E t} y_E = k_H H_S \left[\frac{1}{k_E - k_S} e^{t(k_E - k_S)}\right] \\ + k_H H_M \left[\frac{1}{k_E - k_M} e^{t (k_E - k_M)}\right] \\ + k_H C_H \left[\frac{1}{k_E - k_H} e^{t (k_E - k_H)}\right] + C_E
    \end{split}
\end{equation*}
Where \(C_E\) is a constant \(\in \mathbb{R}\).
Now we solve for \(y_H\) to obtain the formula for the mass of pollutant in lake Huron over time:
\begin{gather*}
    y_E(t) = \frac{k_H H_S}{k_E - k_S} e^{- k_S t} + \frac{k_H H_M}{k_E - k_M} e^{- k_M t} + \frac{k_H C_H}{k_E - k_H} e^{-k_H t} + C_E e^{-k_E t}
\end{gather*}
Once again, we notice a pattern emerging, where a term of the form \[\frac{k_{prev} \cdot \text{(constant from previous lake)}}{k_{current} - k_{i}}\] appears for each upstream lake \(i\). Thus, we can denote:
\begin{gather*}
    y_E(t) = \underbrace{\frac{k_H H_S}{k_E - k_S}}_{E_S} e^{- k_S t} + \underbrace{\frac{k_H H_M}{k_E - k_M}}_{E_M} e^{- k_M t} + \underbrace{\frac{k_H C_H}{k_E - k_H}}_{E_H} e^{-k_H t} + C_E e^{-k_E t}
\end{gather*}

Using this pattern, we can conclude that the general solution for lake \textbf{Ontario}, which has inflow from lake Erie, will be:
\begin{equation*}
    \begin{split}
        y_O(t) = \underbrace{\frac{k_E E_S}{k_O - k_S}}_{O_S} e^{- k_S t} + \underbrace{\frac{k_E E_M}{k_O - k_M}}_{O_M} e^{- k_M t} + \\ \underbrace{\frac{k_E E_H}{k_O - k_H}}_{O_H} e^{-k_H t} + \underbrace{\frac{k_E C_E}{k_O - k_E}}_{O_E} e^{-k_E t} + C_O e^{-k_O t}
    \end{split}
\end{equation*}

\subsection*{Finding the formulas with numerical values}

For lake \textbf{Superior}, the formula for the mass of pollutant over time is:
\begin{gather*}
    y_S(t) = 2900 p e^{\frac{-t}{193.33}}
\end{gather*}
For lake \textbf{Michigan}, the formula for the mass of pollutant over time is:
\begin{gather*}
    y_M(t) = 1180 p e^{\frac{-t}{31.05}}
\end{gather*}
For lake \textbf{Huron}, using equation~\eqref{eq:mass_pollutant_huron_with_constant}, the formula for the mass of pollutant over time is:
\begin{gather*}
    y_H(t) = \frac{k_S}{k_H - k_S} p V_S e^{- k_S t} + \frac{k_M}{k_H - k_M} p V_M e^{- k_M t} + C_H e^{-k_H t} \\
    y_H(t) = 0.07 \cdot 2900 p e^{- \frac{t}{193.33}} + 0.67 \cdot 1180 p e^{- \frac{t}{31.05}} + C_H e^{- \frac{t}{12.50}} \\
    y_H(t) = 200.5 p e^{- \frac{t}{193.33}} + 795.03 p e^{- \frac{t}{31.05}} + C_H e^{- \frac{t}{12.50}}
\end{gather*}
To compute \(C_H\), we can use the initial condition that at \(t = 0\), \(y_H(0) = y_{H_0} = p V_{H}\):
\begin{gather*}
    y_{H_0} = 200.5 p + 795.03 p + C_H \\
    C_H = y_{H_0} - 200.5 p - 795.03 p \\
    C_H = p V_{H} - 200.5 p - 795.03 p \\
    C_H = p \left(V_{H} - 200.5 - 795.03\right)
\end{gather*}
Numerically, this is:
\begin{gather*}
    C_H = p \left(850 - 200.5 - 795.03\right) \\
    C_H = -145.53 p
\end{gather*}
So, the final formula for the mass of pollutant in lake Huron over time is:
\begin{gather*}
    y_H(t) = 200.5 p e^{- \frac{t}{193.33}} + 795.03 p e^{- \frac{t}{31.05}} - 145.53 p e^{- \frac{t}{12.50}}
\end{gather*}
For lake \textbf{Erie}, we can use the pattern we observed to compute the numerical form in terms of \(p\):
\begin{equation*}
    \begin{split}
        y_E(t) = \frac{k_H}{k_E - k_S} 200.5 p e^{- \frac{t}{193.33}} + \frac{k_H}{k_E - k_M} 795.03 p e^{- \frac{t}{31.05}} - \\ \frac{k_H}{k_E - k_H} 145.53 p e^{- \frac{t}{12.50}} + C_E e^{- \frac{t}{1.36}}
    \end{split}
\end{equation*}
\begin{equation*}
    \begin{split}
        y_E(t) =  0.11 \cdot 200.5 p e^{- \frac{t}{193.33}} + 0.11 \cdot 795.03 p e^{- \frac{t}{31.05}} - \\ 0.12 \cdot 145.53 p e^{- \frac{t}{12.50}} + C_E e^{- \frac{t}{1.36}}
    \end{split}
\end{equation*}
To compute \(C_E\), we use the initial condition that at \(t = 0\), \(y_E(0) = y_{E_0} = p V_{E}\):
\begin{gather*}
    y_{E_0} = 22.04 p + 90.79 p - 17.83 p + C_E \\
    C_E = y_{E_0} - 22.04 p - 90.79 p + 17.83 p \\
    C_E = p V_{E} - 22.04 p - 90.79 p + 17.83 p \\
    C_E = p \left(V_{E} - 22.04 - 90.79 + 17.83\right) \\
    C_E = p (116 - 22.04 - 90.79 + 17.83) \\
    C_E = 21 p
\end{gather*}
So, the final formula for the mass of pollutant in lake Erie over time is:
\begin{equation*}
    \begin{split}
        y_E(t) =  22.04 p e^{- \frac{t}{193.33}} + 90.79 p e^{- \frac{t}{31.05}} - \\ 17.83 p e^{- \frac{t}{12.50}} + 21 p e^{- \frac{t}{1.36}}
    \end{split}
\end{equation*}
For lake Ontario, we can use the same pattern to compute the numerical form in terms of \(p\):
\begin{equation*}
    \begin{split}
        y_O(t) = \frac{k_E}{k_O - k_S} 200.5 p e^{- \frac{t}{193.33}} + \frac{k_E}{k_O - k_M} 795.03 p e^{- \frac{t}{31.05}} \\ -  \frac{k_E}{k_O - k_H} 145.53 p e^{- \frac{t}{12.50}} + \frac{k_E}{k_O - k_E} 21 p e^{- \frac{t}{1.36}} + C_O e^{- \frac{t}{3.97}}
    \end{split}
\end{equation*}
\begin{equation*}
    \begin{split}
        y_O(t) = 2.97 \cdot 200.5 p e^{- \frac{t}{193.33}} + 3.34 \cdot 795.03 p e^{- \frac{t}{31.05}} \\ - 4.26 \cdot 145.53 p e^{- \frac{t}{12.50}} - 1.52 \cdot 21 p e^{- \frac{t}{1.36}} + C_O e^{- \frac{t}{3.97}}
    \end{split}
\end{equation*}
\begin{equation*}
    \begin{split}
        y_O(t) = 65.45 p e^{- \frac{t}{193.33}} + 302.80 p e^{- \frac{t}{31.05}} \\ - 76 p e^{- \frac{t}{12.50}} - 32 p e^{- \frac{t}{1.36}} + C_O e^{- \frac{t}{3.97}}
    \end{split}
\end{equation*}
To compute \(C_O\), we use the initial condition that at \(t = 0\), \(y_O(0) = y_{O_0} = p V_{O}\):
\begin{gather*}
    y_{O_0} = 65.45 p + 302.80 p - 76 p - 32 p + C_O \\
    C_O = y_{O_0} - 65.45 p - 302.80 p + 76 p + 32 p \\
    C_O = p V_{O} - 65.45 p - 302.80 p + 76 p + 32 p \\
    C_O = p \left(V_{O} - 65.45 - 302.80 + 76 + 32\right) \\
    C_O = p (393 - 65.45 - 302.80 + 76 + 32) \\
    C_O = 132.75 p
\end{gather*}

\subsection{Computing the time to reduce pollution to 50\% and 5\%}

Because the equations for the pollution mass over time are \textbf{trascendental} (i.e. they involve exponential terms), they are complex and solving for \(t\) such that \(y(t) = 0.5 y_0\) or \(y(t) = 0.05 y_0\) is not trivial.

Thus, we have resorted to use a numerical root finder provided by the \texttt{SciPy} library in Python, specifically the \texttt{fsolve} function from the \texttt{optimize} module.

The function takes an equation to solve and an initial guess for the root. Since in section~\ref{sect:point_b} we computed the times to reduce pollution to 50\% and 5\% assuming clean water from other lakes, we decided to use those values as initial guesses for the solver.

The computed times to reduce the pollution level to 50\% and 5\% of its original level for each lake, taking into account the flow between lakes, are shown in tables~\ref{table:reduce_50_percent_flow} and~\ref{table:reduce_5_percent_flow} respectively.

Additionally, the code used to perform these calculations can be found in listing~\ref{lst:pollution-reduction-flow}.

\begin{table}[H]
    \centering
    \begin{tabular}{|c|c|}
        \hline
        Lake     & Time (in years) to reduce to 50\% \\
        \hline
        Superior & 134.01                            \\
        \hline
        Michigan & 21.52                             \\
        \hline
        Huron    & 33.95                             \\
        \hline
        Erie     & 24.62                             \\
        \hline
        Ontario  & 21.63                             \\
        \hline
    \end{tabular}
    \caption{Time to reduce pollution to 50\% in each lake, considering flow between lakes}
    \label{table:reduce_50_percent_flow}
\end{table}

\begin{table}[H]
    \centering
    \begin{tabular}{|c|c|}
        \hline
        Lake     & Time (in years) to reduce to 5\% \\
        \hline
        Superior & 579.17                           \\
        \hline
        Michigan & 93.03                            \\
        \hline
        Huron    & 300.15                           \\
        \hline
        Erie     & 258.83                           \\
        \hline
        Ontario  & 234.21                           \\
        \hline
    \end{tabular}
    \caption{Time to reduce pollution to 5\% in each lake, considering flow between lakes}
    \label{table:reduce_5_percent_flow}
\end{table}

\newpage \printbibliography

\newpage \appendix
\section{Code listings}
\begin{lstlisting}[caption={Python code used to generate the pollution reduction plot shown in figure~\ref{fig:pollution_decay}},
                   label={lst:pollution-reduction-plot}]
import numpy as np
import matplotlib.pyplot as plt
import matplotlib
import json

plt.figure()

# max years to be shown
t_max = 700  # years
# number of points on x axis (time) to be computed
t = np.linspace(0, t_max, 500)

# load lake data from json
with open('lakes.json'), 'r') as file:
    data = json.load(file)

    for lake, values in data.items():
        k = values["outflow"] / values["vol"] # k = Q_out / V
        P = np.exp(-k * t) * 100 # e^(-kt), in percentage
        plt.plot(t, P, label=f"Lake {lake}")

# add horizontal lines for 50% and 5%
plt.axhline(50, color='blue', linestyle='--', linewidth=1, label=r"50% remaining")
plt.axhline(5, color='red', linestyle='--', linewidth=1, label=r"5% remaining")

plt.xlabel("Time (years)")
plt.ylabel("Pollution Concentration (% of initial)")
plt.legend()
plt.grid(True)
plt.tight_layout()

# show plot
plt.show()
\end{lstlisting}

\begin{lstlisting}[caption={Python code used to compute the time to reduce pollution to 50\% and 5\% considering flow between lakes},
                   label={lst:pollution-reduction-flow}]
import numpy as np
from scipy.optimize import fsolve
import json
import os
import math

# load lake data
with open('lakes.json', 'r') as file:
    data = json.load(file)

# extract lake attributes
V_S = data["Superior"]["vol"]
V_M = data["Michigan"]["vol"]
V_H = data["Huron"]["vol"]
V_E = data["Erie"]["vol"]
V_O = data["Ontario"]["vol"]

k_S = data["Superior"]["outflow"] / V_S
k_M = data["Michigan"]["outflow"] / V_M
k_H = data["Huron"]["outflow"] / V_H
k_E = data["Erie"]["outflow"] / V_E
k_O = data["Ontario"]["outflow"] / V_O

# equations for each lake
# Superior
def y_S(t, p=1):
    return V_S * p * np.exp(-k_S * t)

# Michigan
def y_M(t, p=1):
    return V_M * p * np.exp(-k_M * t)

# Huron
def y_H(t, p=1):
    return (200.5 * p * np.exp(-k_S * t) + 
            795.03 * p * np.exp(-k_M * t) - 
            145.53 * p * np.exp(-k_H * t))

# Erie
def y_E(t, p=1):
    return (22.04 * p * np.exp(-k_S * t) + 
            90.79 * p * np.exp(-k_M * t) - 
            17.83 * p * np.exp(-k_H * t) + 
            21 * p * np.exp(-k_E * t))

# Ontario
def y_O(t, p=1):
    return (65.45 * p * np.exp(-k_S * t) + 
            302.80 * p * np.exp(-k_M * t) - 
            76 * p * np.exp(-k_H * t) - 
            32 * p * np.exp(-k_E * t) + 
            132.75 * p * np.exp(-k_O * t))

# computing reduction times assuming clean water inflow
def reduction_50_percent(attributes):
    V = attributes["vol"]
    Q_out = attributes["outflow"]
    result = - (V / Q_out) * math.log(0.5)
    return result

def reduction_5_percent(attributes):
    V = attributes["vol"]
    Q_out = attributes["outflow"]
    result = - (V / Q_out) * math.log(0.05)
    return result

# finding time t when y(t) = target_percentage * initial_mass
def find_time_for_percentage(lake_func, initial_mass, target_percentage, initial_guess=100):
    def equation(t):
        # express equation as lake_func(t) - target_percentage * initial_mass = 0
        return lake_func(t) - target_percentage * initial_mass
    
    solution = fsolve(equation, initial_guess)
    return solution[0]

# lakes and their functions
lakes = {
    "Superior": (y_S, V_S),
    "Michigan": (y_M, V_M),
    "Huron": (y_H, V_H),
    "Erie": (y_E, V_E),
    "Ontario": (y_O, V_O)
}

# p = 1 for simplicity (cancels out anyway)
p = 1

print("Time to reduce pollution to 50%:")
for lake_name, (lake_func, volume) in lakes.items():
    initial_mass = volume * p
    initial_guess = reduction_50_percent(data[lake_name])
    t_50 = find_time_for_percentage(lake_func, initial_mass, 0.5, initial_guess=initial_guess)
    print(f"{lake_name:10s}: {t_50:8.2f} years")

print("\nTime to reduce pollution to 5%:")
for lake_name, (lake_func, volume) in lakes.items():
    initial_mass = volume * p
    initial_guess = reduction_5_percent(data[lake_name])
    t_5 = find_time_for_percentage(lake_func, initial_mass, 0.05, initial_guess=initial_guess)
    print(f"{lake_name:10s}: {t_5:8.2f} years")
\end{lstlisting}

\end{document}